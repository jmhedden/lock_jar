<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Lock jar : LockJar manages Java Jars for Ruby" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Lock jar</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/mguymon/lock_jar">View on GitHub</a>

          <h1 id="project_title">Lock jar</h1>
          <h2 id="project_tagline">LockJar manages Java Jars for Ruby</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/mguymon/lock_jar/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/mguymon/lock_jar/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="lockjar" class="anchor" href="#lockjar"><span class="octicon octicon-link"></span></a>LockJar</h1>

<p><a href="http://travis-ci.org/mguymon/lock_jar"><img src="https://secure.travis-ci.org/mguymon/lock_jar.png?branch=master" alt="Build Status"></a></p>

<p>LockJar manages Java Jars for Ruby. Powered by <a href="https://github.com/mguymon/naether">Naether</a> to
 create a frankenstein of Bundler and Maven. A Jarfile (<a href="https://github.com/mguymon/lock_jar/blob/master/spec/Jarfile">example</a>) is used to generate a Jarfile.lock that contains all the resolved jar dependencies. The Jarfile.lock can be used to populate the classpath.</p>

<p>LockJar can:</p>

<ul>
<li>Be used directly in MRI 1.9.3, 2.0, 2.1 and JRuby 1.6.x, 1.7.x</li>
<li>From the <a href="https://github.com/mguymon/lock_jar/blob/master/README.md#command-line">command line</a>
</li>
<li><a href="https://github.com/mguymon/lock_jar/blob/master/README.md#gem-integration">Triggered from a Gem install</a></li>
<li><a href="https://github.com/mguymon/lock_jar/blob/master/README.md#buildr-integration">Integrated into Buildr</a></li>
<li>Experimental <a href="https://github.com/mguymon/lock_jar/blob/master/README.md#bundler-integration">integration with Bundler</a>
</li>
</ul><p><a href="https://github.com/mguymon/lock_jar">https://github.com/mguymon/lock_jar</a></p>

<p><a href="http://rubydoc.info/gems/lock_jar/frames">RDoc</a></p>

<h2>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h2>

<pre><code>gem install lock_jar
</code></pre>

<h2>
<a name="ruby-usage" class="anchor" href="#ruby-usage"><span class="octicon octicon-link"></span></a>Ruby Usage</h2>

<p>JRuby is natively supported. Ruby 1.9.3 and 2.1 uses <a href="http://rjb.rubyforge.org/">Rjb</a> to proxy over JNI.</p>

<h3>
<a name="jarfile" class="anchor" href="#jarfile"><span class="octicon octicon-link"></span></a>Jarfile</h3>

<p>A Jarfile is a simple file using a Ruby DSL for defining a project's dependencies using the following 
methods:</p>

<ul>
<li>
<strong>local_repo( path )</strong>: Set the local Maven repository, this were dependencies are downloaded to. </li>
<li>
<strong>remote_repo( url )</strong>: Add additional url of remote Maven repository.</li>
<li>
<strong>group( groups )</strong>: Set the group for nested jar or pom. A single or Array of groups can be set.</li>
<li>
<strong>jar( notations, opts = {} )</strong>: Add Jar dependency in artifact notation, artifact:group:version as the bare minimum. A single or Array of notations can be passed. Default group is <em>default</em>, can be specified by setting <em>opts = { :group =&gt; ['group</em>name'] }_</li>
<li>
<strong>local( path )</strong>: Add a local path to a Jar</li>
<li>
<strong>pom( pom_path, opts = {} )</strong>: Add a local Maven pom, default is to load dependencies for <code>runtime</code> and <code>compile</code> scopes. To select the scopes to be loaded from the pom, set the <em>opts = { :scopes =&gt; ['test'] }</em>
</li>
</ul><h4>
<a name="example-jarfile" class="anchor" href="#example-jarfile"><span class="octicon octicon-link"></span></a>Example Jarfile</h4>

<pre><code>repository 'http://repository.jboss.org/nexus/content/groups/public-jboss'

// Default group is default
jar "org.apache.mina:mina-core:2.0.4"
local 'spec/fixtures/naether-0.13.0.jar'

group 'runtime' do
  jar 'org.apache.tomcat:servlet-api:jar:6.0.35'
end

group 'test' do
  jar 'junit:junit:jar:4.10', :group =&gt; 'test'
end
</code></pre>

<h3>
<a name="resolving-dependencies" class="anchor" href="#resolving-dependencies"><span class="octicon octicon-link"></span></a>Resolving dependencies</h3>

<p><strong>LockJar.lock( *args )</strong>: Using a Jarfile, creates a lock file. Depending on the type of arg, a different configuration is set.</p>

<ul>
<li>
<em>[String]</em> will set the Jarfile path, e.g. <code>'/somewhere/Jarfile.different'</code>. Default jarfile is <code>'Jarfile'</code>
</li>
<li>
<em>[Hash]</em> will set the options, e.g. <code>{ :local_repo =&gt; 'path' }</code>

<ul>
<li>
<strong>:download</strong> <em>[Boolean]</em> if true, will download jars to local repo. Defaults to true.</li>
<li>
<strong>:local_repo</strong> <em>[String]</em> sets the local repo path. Defaults to <code>ENV['M2_REPO']</code> or <code>'~/.m2/repository'</code>
</li>
<li>
<strong>:lockfile</strong> <em>[String]</em> sets the Jarfile.lock path. Default lockfile is <code>'Jarfile.lock'</code>.</li>
</ul>
</li>
</ul><p>When the Jarfile is locked, the transitive dependencies are resolved and saved to the Jarfile.lock file.</p>

<p>Example of locking a Jarfile to a Jarfile.lock</p>

<pre><code>LockJar.lock
</code></pre>

<h3>
<a name="jarfilelock" class="anchor" href="#jarfilelock"><span class="octicon octicon-link"></span></a>Jarfile.lock</h3>

<p>The <em>Jarfile.lock</em> generated is a YAML file containing information on how to handle the classpath for grouped dependencies and their nested transitive dependencies.</p>

<h4>
<a name="the-jarfilelock" class="anchor" href="#the-jarfilelock"><span class="octicon octicon-link"></span></a>The Jarfile.lock</h4>

<pre><code>---
version: 0.7.0
groups:
  default:
    dependencies:
    - ch.qos.logback:logback-classic:jar:0.9.24
    - ch.qos.logback:logback-core:jar:0.9.24
    - com.metapossum:metapossum-scanner:jar:1.0
    - com.slackworks:modelcitizen:jar:0.2.2
    - commons-beanutils:commons-beanutils:jar:1.8.3
    - commons-io:commons-io:jar:1.4
    - commons-lang:commons-lang:jar:2.6
    - commons-logging:commons-logging:jar:1.1.1
    - junit:junit:jar:4.7
    - org.apache.mina:mina-core:jar:2.0.4
    - org.slf4j:slf4j-api:jar:1.6.1
    artifacts:
    - jar:org.apache.mina:mina-core:jar:2.0.4:
        transitive:
          org.slf4j:slf4j-api:jar:1.6.1: {}
    - pom:spec/pom.xml:
        scopes:
        - runtime
        - compile
        transitive:
          com.metapossum:metapossum-scanner:jar:1.0:
            junit:junit:jar:4.7: {}
            commons-io:commons-io:jar:1.4: {}
          commons-beanutils:commons-beanutils:jar:1.8.3:
            commons-logging:commons-logging:jar:1.1.1: {}
          ch.qos.logback:logback-classic:jar:0.9.24:
            ch.qos.logback:logback-core:jar:0.9.24: {}
          commons-lang:commons-lang:jar:2.6: {}
  development:
    dependencies:
    - com.typesafe:config:jar:0.5.0
    artifacts:
    - jar:com.typesafe:config:jar:0.5.0:
        transitive: {}
  test:
    dependencies:
    - junit:junit:jar:4.10
    - org.hamcrest:hamcrest-core:jar:1.1
    artifacts:
    - jar:junit:junit:jar:4.10:
        transitive:
          org.hamcrest:hamcrest-core:jar:1.1: {}
...
</code></pre>

<h3>
<a name="accessing-jars" class="anchor" href="#accessing-jars"><span class="octicon octicon-link"></span></a>Accessing Jars</h3>

<p><strong>LockJar.install(*args)</strong>: Download Jars in the Jarfile.lock</p>

<ul>
<li>
<em>[String]</em> will set the Jarfile.lock path, e.g. <code>'Better.lock'</code>. Default lock file is <code>'Jarfile.lock'</code>.</li>
<li>
<em>[Array]</em> will set the groups, e.g. <code>['compile','test']</code>. Defaults group is <em>default</em>.</li>
<li>
<em>[Hash]</em> will set the options, e.g. <code>{ :local_repo =&gt; 'path' }</code>

<ul>
<li>
<strong>:local_repo</strong> <em>[String]</em> sets the local repo path. Defaults to <code>ENV['M2_REPO']</code> or <code>'~/.m2/repository'</code>
</li>
</ul>
</li>
</ul><p><strong>LockJar.list(*args)</strong>: Lists all dependencies as notations for groups from the Jarfile.lock.  Depending on the type of arg, a different configuration is set.  </p>

<ul>
<li>
<em>[String]</em> will set the Jarfile.lock path, e.g. <code>'Better.lock'</code>. Default lock file is <code>'Jarfile.lock'</code>.</li>
<li>
<em>[Array]</em> will set the groups, e.g. <code>['default', 'runtime']</code>. Defaults group is <em>default</em>.</li>
<li>
<em>[Hash]</em> will set the options, e.g. <code>{ :local_repo =&gt; 'path' }</code>

<ul>
<li>
<strong>:local_repo</strong> <em>[String]</em> sets the local repo path. Defaults to <code>ENV['M2_REPO']</code> or <code>'~/.m2/repository'</code>
</li>
<li>
<strong>:local_paths</strong> <em>[Boolean]</em> converts the notations to paths of jars in the local repo</li>
<li>
<strong>:resolve</strong> <em>[Boolean]</em> to true will make transitive dependences resolve before returning list of jars</li>
</ul>
</li>
</ul><p><strong>LockJar.load(*args)</strong>: Loads all dependencies to the classpath for groups from the Jarfile.lock. Default group is <em>default</em>. Default lock file is <em>Jarfile.lock</em>.</p>

<ul>
<li>
<em>[String]</em> will set the Jarfile.lock, e.g. <code>'Better.lock'</code>
</li>
<li>
<em>[Array]</em> will set the groups, e.g. <code>['default', 'runtime']</code>
</li>
<li>
<em>[Hash]</em> will set the options, e.g. <code>{ :local_repo =&gt; 'path' }</code>

<ul>
<li>
<strong>:local_repo</strong> <em>[String]</em> sets the local repo path</li>
<li>
<strong>:resolve</strong> <em>[Boolean]</em> to true will make transitive dependences resolve before loading to classpath </li>
</ul>
</li>
</ul><p>Once a <em>Jarfile.lock</em> is generated, you can list all resolved jars by</p>

<pre><code>jars = LockJar.list
</code></pre>

<p>or directly load all Jars into the classpath</p>

<pre><code>jars = LockJar.load  
</code></pre>

<p>Do not forget, if you change your <em>Jarfile</em>, you have to re-generate the <em>Jarfile.lock</em>.</p>

<p>See also <a href="https://github.com/mguymon/lock_jar/wiki/ClassLoader">loading Jars into a custom ClassLoader</a>.</p>

<h3>
<a name="shortcuts" class="anchor" href="#shortcuts"><span class="octicon octicon-link"></span></a>Shortcuts</h3>

<h4>
<a name="skipping-the-jarfile" class="anchor" href="#skipping-the-jarfile"><span class="octicon octicon-link"></span></a>Skipping the Jarfile</h4>

<p>You can skip the <em>Jarfile</em> and <em>Jarfile.lock</em> to directly play with dependencies by passing a block to <em>LockJar.lock</em>, <em>LockJar.list</em>, and <em>LockJar.load</em></p>

<h4>
<a name="lock-without-a-jarfile" class="anchor" href="#lock-without-a-jarfile"><span class="octicon octicon-link"></span></a>Lock without a Jarfile</h4>

<pre><code>LockJar.lock do
  jar 'org.eclipse.jetty:example-jetty-embedded:jar:8.1.2.v20120308'
end
</code></pre>

<h4>
<a name="list-without-a-jarfilelock" class="anchor" href="#list-without-a-jarfilelock"><span class="octicon octicon-link"></span></a>List without a Jarfile.lock</h4>

<pre><code>LockJar.list do
  jar 'org.eclipse.jetty:example-jetty-embedded:jar:8.1.2.v20120308'
end
</code></pre>

<h4>
<a name="load-without-a-jarfilelock" class="anchor" href="#load-without-a-jarfilelock"><span class="octicon octicon-link"></span></a>Load without a Jarfile.lock</h4>

<pre><code>LockJar.load do
  jar 'org.eclipse.jetty:example-jetty-embedded:jar:8.1.2.v20120308'
end
</code></pre>

<p>Since you skipped the locking part, mostly likely you will need to resolve the dependences in the block, just pass the <em>:resolve =&gt; true</em> option to enable dependency resolution (also works for <em>LockJar.list</em>).</p>

<pre><code>LockJar.load( :resolve =&gt; true ) do
  jar 'org.eclipse.jetty:example-jetty-embedded:jar:8.1.2.v20120308'
end
</code></pre>

<h2>
<a name="command-line" class="anchor" href="#command-line"><span class="octicon octicon-link"></span></a>Command line</h2>

<p>There is a simple command line helper. You can lock a <em>Jarfile</em> with the following command</p>

<pre><code>lockjar lock
</code></pre>

<p>List jars in a <em>Jarfile.lock</em> with </p>

<pre><code>lockjar list
</code></pre>

<p>Download all jars in a <em>Jarfile.lock</em> with</p>

<pre><code>lockjar install
</code></pre>

<p><em>lockjar</em> <em>--help</em> will give you list of all commands and their options.</p>

<h2>
<a name="gem-integration" class="anchor" href="#gem-integration"><span class="octicon octicon-link"></span></a>Gem Integration</h2>

<h3>
<a name="installing-jars-with-a-gem" class="anchor" href="#installing-jars-with-a-gem"><span class="octicon octicon-link"></span></a>Installing Jars with a Gem</h3>

<p>LockJar can be triggered when a Gem is installed by using a <a href="http://docs.rubygems.org/read/chapter/20#extensions">Gem extension</a>
of type <em>Rakefile</em>. The cavaet is the task to install the jars must be the default for the Rakefile.</p>

<p>A Gem spec with <em>Rakefile</em> extension:</p>

<pre><code>Gem::Specification.new do |s|
  s.extensions = ["Rakefile"]
end
</code></pre>

<p>Rakefile with default to install Jars using LockJar:</p>

<pre><code>task :default =&gt; :prepare

task :prepare do
  require 'lock_jar'

  # get jarfile relative the gem dir
  lockfile = File.expand_path( "../Jarfile.lock", __FILE__ ) 

  LockJar.install( :lockfile =&gt; lockfile )
end
</code></pre>

<h4>
<a name="work-around-for-rakefile-default" class="anchor" href="#work-around-for-rakefile-default"><span class="octicon octicon-link"></span></a>Work around for Rakefile default</h4>

<p>The downside of using the Gem extension Rakefile is it requires the default to 
point at the task to download the jars (from the example Rakefile, 
<code>task :default =&gt; :prepare</code>). To get around this, I used a Rakefile called 
<em>PostInstallRakefile</em> to handle the <code>task :prepare</code>. When packaging the gem, <em>PostInstallRakefile</em> is
renamed to <code>Rakefile</code>.</p>

<h3>
<a name="manually-installing-jars" class="anchor" href="#manually-installing-jars"><span class="octicon octicon-link"></span></a>Manually installing Jars</h3>

<p>Instead of rely in a Rakefile to install Jars when the Gem is installed, Jars can be manually installed. The following
Ruby needs to be called before calling <code>LockJar.load</code>. Only Jars that are missing are downloaded.</p>

<pre><code>  #get jarfile relative the gem dir
  lockfile = File.expand_path( "../Jarfile.lock", __FILE__ ) 

  # Download any missing Jars
  LockJar.install( lockfile )
</code></pre>

<h3>
<a name="loading" class="anchor" href="#loading"><span class="octicon octicon-link"></span></a>Loading</h3>

<p>With the Jars installed, loading the classpath for the Gem is simple. 
As part of the load process for the Gem (an entry file that is required, etc) use the following:</p>

<pre><code>  #get jarfile relative the gem dir
  lockfile = File.expand_path( "../Jarfile.lock", __FILE__ ) 

  # Loads the ClassPath with Jars from the lockfile
  LockJar.load( :lockfile =&gt; lockfile )
</code></pre>

<p>See also <a href="https://github.com/mguymon/lock_jar/wiki/ClassLoader">loading Jars into a custom ClassLoader</a>.</p>

<h2>
<a name="buildr-integration" class="anchor" href="#buildr-integration"><span class="octicon octicon-link"></span></a>Buildr Integration</h2>

<p>LockJar integrates with <a href="http://buildr.apache.org/">Buildr</a> using an <a href="https://github.com/mguymon/lock_jar/blob/master/lib/lock_jar/buildr.rb">Addon</a>. This allows the Jarfile to be defined directly into a <em>buildfile</em>. A global LockJar definition can be set and is inherited to all projects. Each project may have its own LockJar definition. A lock file is generated per project based on the project name.</p>

<p>A new Buildr task is added to generate the lockfile for all projects</p>

<pre><code>buildr lock_jar:lock
</code></pre>

<p>and a task per project to generate the lockfile for a single project</p>

<pre><code>buildr &lt;app&gt;:&lt;project&gt;:lock_jar:lock
</code></pre>

<p>In a project, you can access an Array of notations using the <strong>lock_jars</strong> method, accepts same parameters as <a href="https://github.com/mguymon/lock_jar#accessing-jars">LockJar.list</a></p>

<pre><code>lock_jars()
</code></pre>

<p>The <em>default</em> group dependencies are automatically added to the classpath for compiling. The <em>test</em> group dependencies are automatically added to the classpath for tests. Do not forget, if you change the LockJar definitions, you have to rerun the <strong>lock_jar:lock</strong> task.</p>

<h3>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h3>

<p>Sample buildfile with LockJar</p>

<pre><code>require 'lock_jar/buildr'

# app definition, inherited into all projects
lock_jar do

     group 'test' do
       jar 'junit:junit:jar:4.10'
     end
end

define 'app' do

   def 'project1' do
     lock_jar do
       jar  "org.apache.mina:mina-core:2.0.4"
     end
   end

   def 'project2' do
      lock_jar do
        pom 'pom.xml'
      end
   end

end
</code></pre>

<p>Generated the following lock files using <strong>lock_jar:lock</strong></p>

<ul>
<li>
<em>project1.lock</em> - contains <em>junit</em> and <em>mina</em> jars.</li>
<li>
<em>project2.lock</em> - contains <em>junit</em> and <em>pom.xml</em> jars.</li>
</ul><h2>
<a name="bundler-integration" class="anchor" href="#bundler-integration"><span class="octicon octicon-link"></span></a>Bundler Integration</h2>

<p>Bundler integration is <strong>experimental</strong> right now. <a href="https://github.com/mguymon/lock_jar/blob/master/lib/lock_jar/bundler.rb">LockJar patches Bundler</a> 
to allow creation of a <em>Jarfile.lock</em> when Bundler calls <code>install</code> and <code>update</code>. The dependencies from the <em>Jarfile.lock</em> are automatically loaded when
Bundler  calls <code>setup</code> and <code>require</code>. To enable this support, add this require to your <em>Gemfile</em></p>

<pre><code>require 'lock_jar/bundler'
</code></pre>

<p>You can optionally create a <em>Jarfile</em> that will automatically be included when you <code>bundle install</code> or <code>bundle update</code>. Otherwise
Gems with a Jarfile will be merge to generate a <em>Jarfile.lock</em>. The Jarfile.lock will be loaded when Bundler calls <code>setup</code> or <code>require</code>.</p>

<h3>
<a name="bundler-to-lockjar-groups" class="anchor" href="#bundler-to-lockjar-groups"><span class="octicon octicon-link"></span></a>Bundler to LockJar groups</h3>

<p>LockJar will merge the dependencies from the <code>default</code> and <code>runtime</code> group of a Gem's <em>Jarfile</em>. These will be placed in the 
lockfile under Gem's corresponding Bundler group. For example, the following Gemfile:</p>

<pre><code>group :development do
  gem 'solr_sail', '~&gt;0.1.0'
end
</code></pre>

<p>Would produce the follow <em>Jarfile.lock</em> excerpt:</p>

<pre><code>---
version: 0.7.0
merged:
- gem:solr_sail:gems/solr_sail-0.1.0-java/Jarfile
groups:
  default:
    dependencies: []
    artifacts: []
  development:
    dependencies:
     - ch.qos.logback:logback-classic:jar:1.0.6
     - ch.qos.logback:logback-core:jar:1.0.6
     - com.google.guava:guava:jar:r05
</code></pre>

<p>Since <code>solr_sail</code> is defined in the <em>Gemfile's</em> <code>development</code> group, the corresponding <em>Jarfile.lock</em> dependencies are also under the <code>development</code> group.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with this
work for additional information regarding copyright ownership.  The ASF
licenses this file to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
License for the specific language governing permissions and limitations under
the License.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Lock jar maintained by <a href="https://github.com/mguymon">mguymon</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-34340702-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
